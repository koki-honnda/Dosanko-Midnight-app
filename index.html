<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Semi-Permanent Map</title>
    <!-- 地図ライブラリ MapLibre GL JS -->
    <script src="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.x/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .menu-bar {
            position: absolute; top: 10px; left: 10px; z-index: 1;
            background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .btn { margin-bottom: 5px; display: block; width: 100%; cursor: pointer; }
    </style>
</head>
<body>

<div class="menu-bar">
    <button class="btn" onclick="locateUser()">現在地へ移動</button>
    <button class="btn" onclick="openGoogleMaps()">Googleマップで開く</button>
</div>
<div id="map"></div>

<script>
    // 1. 地図の初期化 (OpenStreetMapのタイルを使用)
    const map = new maplibregl.Map({
        container: 'map',
        style: {
            version: 8,
            sources: {
                'osm': {
                    type: 'raster',
                    tiles: ['https://tile.openstreetmap.org/{z}/{x}/{y}.png'],
                    tileSize: 256,
                    attribution: '© OpenStreetMap contributors'
                }
            },
            layers: [{
                id: 'osm-layer',
                type: 'raster',
                source: 'osm'
            }]
        },
        center: [139.767, 35.681], // 東京駅付近
        zoom: 13
    });

    // 2. 現在地取得機能
    let userMarker;
    function locateUser() {
        navigator.geolocation.getCurrentPosition(pos => {
            const { latitude, longitude } = pos.coords;
            map.flyTo({ center: [longitude, latitude], zoom: 15 });
            
            if (userMarker) userMarker.remove();
            userMarker = new maplibregl.Marker({ color: 'blue' })
                .setLngLat([longitude, latitude])
                .addTo(map);
        }, err => alert("位置情報の取得に失敗しました"), { enableHighAccuracy: true });
    }

    // 3. 予備手段：Googleマップを外部起動
    function openGoogleMaps() {
        const center = map.getCenter();
        const url = `https://www.google.com/maps/@${center.lat},${center.lng},15z`;
        window.open(url, '_blank');
    }
</script>
</body>
</html>
